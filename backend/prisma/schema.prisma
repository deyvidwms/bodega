generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Bodega {
  id Int @id @default(autoincrement())

  nome      String
  descricao String
  cnpj      String @unique
  endereco  String
  imagem    String

  usuarios      Usuario[]
  produtos      Produto[]
  clienteBodega ClienteBodega[]
}

model CategoriaProduto {
  id Int @id @default(autoincrement())

  nome   String
  imagem String

  produtos Produto[]
}

model Lote {
  id Int @id @default(autoincrement())

  quantidadeInicial Int
  quantidadeAtual   Int
  validade          DateTime?
  compradoEm        DateTime
  custo             Decimal

  idProduto Int
  idCriador Int

  produto   Produto @relation(fields: [idProduto], references: [id])
  criadoPor Usuario @relation(fields: [idCriador], references: [id])

  vendas VendaLote[]
}

model Produto {
  id Int @id @default(autoincrement())

  titulo    String
  descricao String
  imagem    String

  idCriador Int?
  criadoPor Usuario? @relation(fields: [idCriador], references: [id])

  idBodega Int?
  bodega   Bodega? @relation(fields: [idBodega], references: [id])

  idCategoriaProduto Int?
  CategoriaProduto   CategoriaProduto? @relation(fields: [idCategoriaProduto], references: [id])

  lotes Lote[]
}

model Pessoa {
  id Int @id @default(autoincrement())

  cpf      String  @unique
  nome     String
  celular  String? @unique
  endereco String?

  Usuario       Usuario?
  ClienteBodega ClienteBodega[]
}

model Usuario {
  id Int @id @default(autoincrement())

  email String @unique
  senha String

  idPessoa Int    @unique
  pessoa   Pessoa @relation(fields: [idPessoa], references: [id])

  idBodega Int?
  bodega   Bodega? @relation(fields: [idBodega], references: [id])

  produtos Produto[]
  lotes    Lote[]
}

model VendaLote {
  id Int @id @default(autoincrement())

  quantidade Int

  valor Decimal

  idVenda Int?
  idLote  Int

  venda Venda? @relation(fields: [idVenda], references: [id])
  lote  Lote   @relation(fields: [idLote], references: [id])
}

model Venda {
  id Int @id @default(autoincrement())

  vendidoEm DateTime

  vendaLotes VendaLote[]
}

model ClienteBodega {
  id Int @id @default(autoincrement())

  idCliente Int
  cliente   Pessoa @relation(fields: [idCliente], references: [id])

  idBodega Int
  bodega   Bodega @relation(fields: [idBodega], references: [id])
}
